var package = require('./package.json'),
    exec = require('child_process').exec;

module.exports = {
    // The standard npm command to install
    cmd: "npm install --save ",
    // A string which holds the dependencies from the package.json
    modules: "",
    // runs the command and outputs the data
    run: function (command, toRun) {

        console.log("Installing dependencies...");

        var proc = exec(command);

        // when data is recieved
        proc.stdout.on('data', function (chunk) {

            // run the callback function
            if (typeof toRun == "function") {
                toRun(chunk);
            }

        });

        // when data is recieved
        proc.stdout.on('error', function (chunk) {

           throw new Error(chunk);

        });

    },
    // wrapper function to make life so much easier
    go: function (toRun) {

        // go through each dependencies in the package.json
        for (var dep in package.dependencies) {

            // append it to the modules string
            this.modules += dep + " ";

        }

        // finally append it to the npm install
        this.cmd += this.modules;

        // run the command
        this.run(this.cmd, function (data) {

            // output the data recieved
            if (typeof toRun === "function") {
                toRun(data);
            }

        });

    }
};
